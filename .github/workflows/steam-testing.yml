name: steam-testing

on: 
  workflow_dispatch
  
jobs:
  test:
    name: test
    runs-on: self-hosted
    steps:
      - name: dummy
          run |
          echo "${{github.sha}} > dummy.txt
      
      - name: deploy
        uses: game-ci/steam-deploy@v2
        with:
          username: ${{ secrets.STEAM_USERNAME }}
          password: ${{ secrets.STEAM_PASSWORD }}
          configVdf: ${{ secrets.STEAM_CONFIG_VDF}}
          ssfnFileName: ${{ secrets.STEAM_SSFN_FILE_NAME }}
          ssfnFileContents: ${{ secrets.STEAM_SSFN_FILE_CONTENTS }}
          appId: ${{ secrets.STEAM_APP_ID }}
          buildDescription: testing steam deploy {{github.sha}}
          rootPath: .
          depot2Path: dummy.txt
          releaseBranch: development
          

  cleanup:
    name: Cleanup
    runs-on: self-hosted
    needs: [test]
    if: ${{ always() }}
    steps:
      - name: Cleanup
        uses: AutoModality/action-clean@v1
          
          
